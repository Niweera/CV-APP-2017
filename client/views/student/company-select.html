<script type="text/javascript">
    if (typeof userID == 'undefined') {
        window.location.replace('./');
    }
</script>

<div class="row clearfix">
    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2>Available Companies</h2>
            </div>
            <div class="body">
                <table id="companyTable" class="table table-bordered table-striped table-hover" cellspacing="0"
                       width="100%">
                    <thead>
                    <tr>
                        <th>Company Name</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2>
                    Selected Companies
                </h2>
            </div>
            <div class="body">
                <table id="chosedTable" class="table table-bordered table-striped table-hover" cellspacing="0"
                       width="100%">
                    <thead>
                    <tr>
                        <th>Company Name</th>
                        <th>Position</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal Dialogs ====================================================================================================================== -->
<!-- Default Size -->
<div class="modal fade" id="positionModal" tabindex="-1" role="dialog">
    <div class="modal-dialog model-sm" role="document">
        <div class="modal-content ">
            <div class="modal-header">
                <h4 class="modal-title" id="positionModalLabel">Positios - Comapny Name</h4>
            </div>

            <div id="positionModalBody" class="modal-body">
                <form name="positionForm_" id="positionForm">
                    <div id="position-form-group" class="form-group">
                          <!--dyanamically append data  -->
                    </div>
                </form>
            </div>

            <div class="modal-footer ">
                <button type="button" class="btn btn-warning waves-effect" data-dismiss="modal">CLOSE</button>
                <button type="button" class="btn btn-info waves-effect saveButton">SAVE CHANGES</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
  "undefined"==typeof userID?window.location.replace("./"):($(document).ready(function(){function e(){var e=[];return $("input[name='position[]']").each(function(){$(this).is(":checked")&&e.push($(this).val())}),e}function t(){}function o(e,o,s,a,r){$.ajax({type:e,url:r,data:o,dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",getToken())},success:function(e){switch(s){case"ajaxRemove":"success"==e.status?(n("Company removed successfully!"),g.row(a).remove().draw(),d.ajax.reload(null,!1)):(showErrorMessage("Unexpected error #1, Please try again"),console.log(e));break;case"ajaxSave":"success"==e.status?(l.modal("toggle"),n("Company selected successfully!"),d.row(a).remove().draw(),g.ajax.reload(null,!1),t()):(showErrorMessage("Unexpected error #2, Please try again"),console.log(e))}},error:function(e,t,o){console.log(e),alert("Unexpected error"),console.log(t,o),showErrorMessage(o)}})}function n(e){showNotification("alert-success",e,"top","right",null,null,1500)}var s='<a class="btn btn-warning waves-effect btn-sm ajaxSelect"> Select</a>',a='<a class="btn btn-danger waves-effect btn-sm ajaxRemove"> Remove</a>',r="ajaxRemove",i="ajaxSelect",u="saveButton",l=$("#positionModal"),c=$("#positionForm"),d=$("#companyTable").DataTable({dom:"Bfrtip",responsive:!0,buttons:[],ajax:{url:domain+"company/withoutselected/"+userID,dataSrc:"result",beforeSend:function(e){e.setRequestHeader("Authorization",getToken())}},columns:[{data:"name"},{data:null,defaultContent:s}],language:{emptyTable:"No companies available."}}),g=$("#chosedTable").DataTable({dom:"Bfrtip",responsive:!0,buttons:[],ajax:{url:domain+"student_company/companies/"+userID,dataSrc:"result",beforeSend:function(e){e.setRequestHeader("Authorization",getToken())}},columns:[{data:"company"},{data:"position"},{data:null,defaultContent:a}],language:{emptyTable:"You have not selected any companies."}});g.on("click","."+r,function(){var e=g.row($(this).parents("tr")).data();o("DELETE","","ajaxRemove",$(this).parents("tr"),domain+"student_company/"+e._id)});var m="",f="",p="";d.on("click","."+i,function(){m=d.row($(this).parents("tr")).data(),p=$(this).parents("tr"),f="&student="+userID+"&company="+m._id+"&choice="+m.name,l.modal("toggle")}),l.on("show.bs.modal",function(e){$(this).find("#positionModalLabel").html(m.name+" - Positions"),$.each(m.positions,function(e,t){var o="<div class='form-group'><input type='checkbox' name='position[]' value = '"+t+"' id="+e+" class='filled-in chk-col-blue'/><label for="+e+">"+t+"</label></div>";$("#position-form-group").append(o)})}),l.on("hidden.bs.modal",function(e){$("#position-form-group").empty()}),l.on("click","."+u,function(){if(c.valid()){var t=f+"&position="+e(),n=domain+"student_company";o("POST",t,"ajaxSave",p,n)}})}),$(function(){$("#positionForm").validate({rules:{"position[]":{required:!0}},messages:{"position[]":"You have to select at least one position"},highlight:function(e){console.log(e),$(e).parents(".form-line").addClass("error")},unhighlight:function(e){$(e).parents(".form-line").removeClass("error")},errorPlacement:function(e,t){$("#position-form-group").append(e),console.log(e)}})}),$(function(){$.AdminBSB.input.activate(),$.AdminBSB.select.activate()}));
</script>
