<script type="text/javascript">
    if (typeof userID == 'undefined') {
        window.location.replace('./');
    }
</script>

<div class="row clearfix">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2 id="page-header">
                    Upload Your CV
                </h2>
            </div>
            <div class="body">

                <form name="cvForm" enctype="multipart/form-data" id="form_validation">
                    <p>Upload New CV</p>
                    <div class="form-group">
                        <div class="form-line">
                            <div class="fallback">
                                <input name="file" type="file" accept="application/pdf" required/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary waves-effect" type="submit" id="submit-btn">UPLOAD</button>
                    </div>
                </form>

                <div class="form-line">
                    <div id="cv-pdf-view">
                        <!-- pdf appear here -->
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
  function setPdfView(e){$("input[name=file]").val(""),$("#cv-pdf-view").empty();var t=document.createElement("embed");t.setAttribute("src","/uploads/"+e),t.setAttribute("width","100%"),t.setAttribute("height","1000px"),t.setAttribute("type","application/pdf"),$("#cv-pdf-view").append(t),$("#submit-btn").text("UPDATE"),$("#page-header").text("Your CV")}"undefined"==typeof userID?window.location.replace("./"):($(document).ready(function(){$.ajax({type:"GET",url:domain+"cv",data:{userID:userID},beforeSend:function(e){e.setRequestHeader("Authorization",getToken())},dataType:"json",success:function(e){1==e.success?e.data.length>0&&setPdfView(e.data[0].filename):(showErrorMessage("Something went wrong"),console.log(e))},error:function(e,t,o){showErrorMessage("Something went wrong"),console.log(e),console.log(t,o)}}),$("#form_validation").submit(function(e){if($(this).valid()){e.preventDefault();var t=$("input[name=file]").val().split(".").pop().toLowerCase();if(-1==$.inArray(t,["pdf"]))showErrorMessage("We accept only PDF formatted file!","Error");else{var o=new FormData(this);o.append("userID",userID),o.append("studentName",studentObject.name),swal({title:"Please confirm your upload.",text:"Submit to upload your CV",type:"info",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){$.ajax({type:"POST",url:"/cv/upload",data:o,processData:!1,contentType:!1,beforeSend:function(e){e.setRequestHeader("Authorization",getToken())},success:function(e){1==e.success?(showSuccessMessage(e.msg),setPdfView(e.data.filename)):(showErrorMessage(e.msg),console.log(e))},error:function(e,t,o){console.log(e),console.log(t,o)}})})}}return!1})}),$(function(){$("#form_validation").validate({highlight:function(e){console.log(e),$(e).parents(".form-line").addClass("error")},unhighlight:function(e){$(e).parents(".form-line").removeClass("error")},errorPlacement:function(e,t){$(t).parents(".input-group").append(e),$(t).parents(".form-group").append(e)}})}),$(function(){$.AdminBSB.input.activate(),$.AdminBSB.select.activate()}));
</script>
