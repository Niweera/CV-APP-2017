<script type="text/javascript">
    if (typeof userID == 'undefined') {
        window.location.replace('./');
    }
</script>

<div class="row clearfix">
    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
        <div class="card">
            <div class="body">
                <ul class="nav nav-tabs tab-nav-right" id="navdiv" role="tablist">
                    <!-- position tabs goes here -->
                </ul>
            </div>
        </div>
    </div>

    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
        <div class="card">
            <div class="body" style="padding: 20px 10px;">
                <div style="height: 41px">
                    <div class="col-xs-2" id="student-count" style="padding: 0; font-size: 30px; margin-right: 8px; text-align: center;">4</div>
                    <div class="col-xs-3" style="padding: 0;">Slots reserved</div>
                    <div class="col-xs-offset-1 col-xs-2" id="panel-count" style="padding: 0; font-size: 30px; margin-right: 8px; text-align: center;">1</div>
                    <div class="col-xs-3" style="padding: 0;">Panel(s) required <span style="float:right; margin: 0 auto"><i class="material-icons">info</i></span></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row clearfix">
    <div class="col-lg-8 col-md-7 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2 id="applicant-table-header">Applicants</h2>
            </div>
            <div class="body">
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade in active" id="tablediv">
                        <table id="apllicantTable" class="table table-bordered table-striped table-hover"
                               cellspacing="0" width="100%">
                            <thead>
                            <tr>
                                <th></th>
                                <th>Name</th>
                                <th>Year</th>
                                <th>Stream</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2>
                    Shortlisted Applicants
                </h2>
            </div>
            <div class="body">
                <table id="shortListedTable" class="table table-bordered table-striped table-hover" cellspacing="0"
                       width="100%">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
"undefined"==typeof userID?window.location.replace("./"):$(document).ready(function(){function e(e){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Full name:</td><td>'+e.name+"</td></tr><tr><td>Phone number:</td><td>"+e.phone+"</td></tr><tr><td>Year:</td><td>"+e.year+"</td></tr><tr><td>Email:</td><td>"+e.email+"</td></tr><tr><td>Stream:</td><td>"+e.stream+"</td></tr></table>"}function t(e,t,a,s,i){$.ajax({type:e,url:i,data:t,dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",getToken())},success:function(e){switch(a){case"ajaxRemove":"success"==e.status?(o("Student removed successfully!"),m.row(s).remove().draw(),p.ajax.reload(null,!1)):(n("Unexpected error #1, Please try again"),console.log(e));break;case"ajaxSelect":"success"==e.status?(o("Student short listed successfully!"),p.row(s).remove().draw(),m.ajax.reload(null,!1)):(n("Unexpected error #2, Please try again"),console.log(e));break;case"ajaxCount":"success"==e.status?($("#student-count").text(e.data),$("#panel-count").text(Math.ceil(e.data/8))):(n("Unexpected error #2, Please try again"),console.log(e))}},error:function(e,t,o){console.log(e),n("Unexpected error"),console.log(t,o)}})}function n(e){swal(e+"!","","error")}function o(e){showNotification("alert-success",e,"top","right",null,null,2e3)}var a='<a class="btn btn-success btn-sm  waves-effect ajaxSelect" style = "margin-right:10px;" title="Select"> <i class="material-icons">done_all</i> </a>',s='<a class="btn btn-info btn-sm  waves-effect ajaxView" style = "margin-right:10px;" title="View CV"> <i class="material-icons">description</i> </a>',i='<a class="btn btn-danger btn-sm waves-effect  ajaxRemove"> Remove</a>',r="ajaxRemove",l="ajaxSelect",c="ajaxView";companyObject.positions.forEach(function(e){var t="<li role='presentation'><a class='positionTab' href='#tablediv' data-toggle='tab'>"+e+"</a></li>";$("#navdiv").append(t)});var u=$("#navdiv").children()[0];$(u).addClass("active");var d=companyObject.positions[0],p=$("#apllicantTable").DataTable({dom:"Bfrtip",responsive:!0,buttons:[{extend:"pdfHtml5",message:"Not shortlisted applicants - "+d,title:"UCSC Career Fair 2017",filename:"Not shortlisted applicants - "+d,exportOptions:{columns:[1,2,3]},init:function(e,t,n){$(".positionTab").on("click",function(){n.message=n.filename="Not shortlisted applicants - "+$(this).text()})}}],ajax:{url:domain+"student_company/students",data:function(e){e.company=companyObject._id,e.position=d},beforeSend:function(e){e.setRequestHeader("Authorization",getToken())},dataSrc:"result"},columns:[{className:"details-control",orderable:!1,data:null,defaultContent:"",width:"10%"},{data:"name"},{data:"year",width:"20%"},{data:"stream",width:"10%"},{width:"20%",data:null,defaultContent:s+a}],order:[[1,"asc"]],initComplete:function(){this.api().columns().every(function(){if(2==this[0]||3==this[0]){var e=this,t=$('<select><option value="">All</option></select>').appendTo($(e.header()).append("</br> ")).on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,n){t.append('<option value="'+e+'">'+e+"</option>")})}})},language:{emptyTable:"Sorry! No applicants available for this position."}});$("#apllicantTable tbody").on("click","td.details-control",function(){var t=$(this).closest("tr"),n=p.row(t);n.child.isShown()?(n.child.hide(),t.removeClass("shown")):(n.child(e(n.data())).show(),t.addClass("shown"))}),p.on("click","."+l,function(){var e=p.row($(this).parents("tr")).data(),n=domain+"selected_student_company",o=$(this).parents("tr");t("POST","&company="+companyObject._id+"&student="+e.userID+"&position="+d,"ajaxSelect",o,n)}),p.on("click","."+c,function(){var e=p.row($(this).parents("tr")).data();window.open(domain+"uploads/"+e.cv)}),p.on("draw.dt",function(){0===p.data().length?p.buttons().disable():p.buttons().enable()});var m=$("#shortListedTable").DataTable({dom:"Bfrtip",responsive:!0,buttons:[{extend:"pdfHtml5",message:"Shortlisted Applicants - "+d,title:"UCSC Career Fair 2017",filename:"Shortlisted Applicants - "+d,exportOptions:{columns:[0]},init:function(e,t,n){$(".positionTab").on("click",function(){n.message=n.filename="Shortlisted applicants - "+$(this).text()})}}],ajax:{url:domain+"selected_student_company/students",data:function(e){e.company=companyObject._id,e.position=d},beforeSend:function(e){e.setRequestHeader("Authorization",getToken())},dataSrc:"result"},columns:[{data:"name"},{width:"20%",data:null,defaultContent:i}],language:{emptyTable:"No applicants shortlisted for this position."}});m.on("click","."+r,function(){var e=m.row($(this).parents("tr")).data();t("DELETE","","ajaxRemove",$(this).parents("tr"),domain+"selected_student_company/"+e._id)}),m.on("draw",function(){t("GET",{company:companyObject._id},"ajaxCount",null,domain+"selected_student_company/student_count"),0===m.data().length?m.buttons().disable():m.buttons().enable()}),$(".positionTab").click(function(){d=$(this).text(),p.ajax.reload(),m.ajax.reload()})});
</script>
