<script type="text/javascript">
    if (typeof userID == 'undefined') {
        window.location.replace('./');
    }
</script>

<div class="row clearfix">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="body">
                <ul class="nav nav-tabs tab-nav-right" id="navdiv" role="tablist">
                    <!-- position tabs goes here -->
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="row clearfix">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2 id="applicant-table-header">All Applicants</h2>
            </div>
            <div class="body">
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade in active" id="tablediv">
                        <table id="apllicantTable" class="table table-bordered table-striped table-hover"
                               cellspacing="0" width="100%">
                            <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Year</th>
                                <th>Stream</th>
                                <th>CV</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
"undefined"==typeof userID?window.location.replace("./"):$(document).ready(function(){function e(){var e=[];s.rows().every(function(){var t=this.data();e.push(t.cv)}),$.ajax({type:"POST",url:domain+"cv/download",data:{cvs:e,position:a,company:companyObject.userID},dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",getToken())},success:function(e){!0===e.success?window.open(domain+e.data):showErrorMessage(e.msg)},error:function(e,t,o){console.log(e),console.log(t,o)}})}var t='<a class="btn btn-info btn-sm  waves-effect ajaxView" style = "margin-right:10px;" title="View CV"> <i class="material-icons">description</i> </a>',o="ajaxView";companyObject.positions.forEach(function(e){var t="<li role='presentation'><a class='positionTab' href='#tablediv' data-toggle='tab'>"+e+"</a></li>";$("#navdiv").append(t)});var n=$("#navdiv").children()[0];$(n).addClass("active");var a=companyObject.positions[0],s=$("#apllicantTable").DataTable({dom:"Bfrtip",responsive:!0,buttons:[{extend:"pdfHtml5",message:"All Applicants - "+a,title:"UCSC Career Fair 2017",filename:"All Applicants - "+a,exportOptions:{columns:[0,1,2,3,4]},init:function(e,t,o){$(".positionTab").on("click",function(){o.message=o.filename="All Applicants - "+$(this).text()})}},{text:"Download All "+a+" CVs",action:function(t,o,n,a){e()},className:"download-all"}],ajax:{url:domain+"student_company/students/all",data:function(e){e.company=companyObject._id,e.position=a},beforeSend:function(e){e.setRequestHeader("Authorization",getToken())},dataSrc:"result"},columns:[{data:"name"},{data:"email"},{data:"phone"},{data:"year",width:"15%"},{data:"stream",width:"12%"},{width:"10%",data:null,defaultContent:t}],order:[[1,"asc"]],initComplete:function(){this.api().columns().every(function(){if(3==this[0]||4==this[0]){var e=this,t=$('<select><option value="">All</option></select>').appendTo($(e.header()).append("</br> ")).on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,o){t.append('<option value="'+e+'">'+e+"</option>")})}})},language:{emptyTable:"Sorry! No applicants available for this position."}});s.on("click","."+o,function(){var e=s.row($(this).parents("tr")).data();window.open(domain+"uploads/"+e.cv)}),s.on("draw.dt",function(){0===s.data().length?s.buttons().disable():s.buttons().enable()}),$(".positionTab").click(function(){a=$(this).text(),s.ajax.reload(),$(".download-all")[0].children[0].innerText="Download All "+$(this).text()+" CVs"})});

</script>
