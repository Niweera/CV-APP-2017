<!-- Exportable Table -->
<div class="row clearfix">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2>
                    Student Table
                </h2>
            </div>
            <div class="body">
                <table id="studentTable" class="table table-bordered table-striped table-hover">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Year</th>
                        <th>Email</th>
                        <th>Stream</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2>
                    Selected Companies
                </h2>
            </div>
            <div class="body">
                <table id = "companyTable" class="table table-bordered table-striped table-hover" cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th>Company</th>
                        <th>Position</th>
                        <th>Slot</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2>
                    Schedule
                </h2>
            </div>
            <div class="body">
                <table id = "scheduleTable" class="table table-bordered table-striped table-hover" cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th width="20%">Time Slot</th>
                        <th>Company</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- #END# Exportable Table -->

<script>
$(document).ready(function() {
    var slots = [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8"
    ];

    var selectButton =  '<a class="btn btn-warning waves-effect btn-sm ajaxSelect"> </span> Select</a>';

    var studentTable = $('#studentTable').DataTable({
    dom: 'Bfrtip',
    responsive: true,
    buttons: [
        'copy', 'csv', 'excel', 'pdf', 'print'
    ],
      ajax: {
          url: 'http://localhost:3000/student/all',
          dataSrc: 'result'
      },
      "columns": [
          { "data": "name" },
          { "data": "phone" },
          { "data": "year" },
          { "data": "email" },
          { "data": "stream" }
      ]
    });

    var companyTable = $('#companyTable').DataTable({
        "order": [],
        dom: 'Bfrtip',
        responsive: true,
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ],
        ajax: {
            url: 'http://localhost:3000/selected_student_company/companies/' + user_id,
            dataSrc: 'result'
        },
        "columns": [
            { "data": "company" },
            { "data": "position" },
            {
                "render": function(d,t,r){
                    var $select = $("<select></select>", {
                        "id": r[0]+"start",
                        "value": d
                    });
                    $.each(slots, function(k,v){
                        var $option = $("<option></option>", {
                            "text": v,
                            "value": v
                        });
                        if(d === v){
                            $option.attr("selected", "selected")
                        }
                        $select.append($option);
                    });
                    return $select.prop("outerHTML");
                }
            },
            {   "data": null,
                "defaultContent": selectButton
            }
        ]
    });


    var scheduleTable = $('#scheduleTable').DataTable({
        dom: 'Bfrtip',
        responsive: true,
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ],
        ajax: {
            url: 'http://localhost:3000/student_schedule/schedule/' + user_id,
            dataSrc: 'result'
        },
        "columns": [
            { "data": "slot" },
            { "data": "company" }
        ]
    });

    // Defines what happens on the button click on student table row
    studentTable.on('click', 'tr', function () {
        if ( $(this).hasClass('selected') ) {
            $(this).removeClass('selected');
        }
        else {
            studentTable.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
        }

        var rowData = studentTable.row($(this)).data();
        user_id = rowData['userID'];

        // Reload datatables with the new user id
        companyTable.ajax.url('http://localhost:3000/selected_student_company/companies/' + user_id).load();
        scheduleTable.ajax.url('http://localhost:3000/student_schedule/schedule/' + user_id).load();

    });

});
</script>
