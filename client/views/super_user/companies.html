<!-- Exportable Table -->
<div class="row clearfix">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="header">
                <h2>
                    Company Table
                </h2>
            </div>
            <div class="body">
                <table id="studentTable" class="table table-bordered table-striped table-hover">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Year</th>
                        <th>Email</th>
                        <th>Stream</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- #END# Exportable Table -->

<script>
$(document).ready(function() {
    var slots = [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8"
    ];

    var selectButton =  '<a class="btn btn-warning waves-effect btn-sm ajaxSelect"> </span> Select</a>';
    var removeButton = '<a class="btn btn-danger btn-sm waves-effect  ajaxRemove"> Remove</a>';

    var ajaxRemove = "ajaxRemove";
    var ajaxSelect = 'ajaxSelect';

    var studentTable = $('#studentTable').DataTable({
    dom: 'Bfrtip',
    responsive: true,
    buttons: [
        'copy', 'csv', 'excel', 'pdf', 'print'
    ],
      ajax: {
          url: domain + 'student/all',
          dataSrc: 'result'
      },
      "columns": [
          { "data": "name" },
          { "data": "phone" },
          { "data": "year" },
          { "data": "email" },
          { "data": "stream" }
      ]
    });


    // Defines what happens on the button click on student table row
    studentTable.on('click', 'tr', function () {
        if ( $(this).hasClass('selected') ) {
            $(this).removeClass('selected');
        }
        else {
            studentTable.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
        }

        var rowData = studentTable.row($(this)).data();
        user_id = rowData['userID'];

        // Reload datatables with the new user id
        companyTable.ajax.url(domain + 'selected_student_company/companies/' + user_id).load();
        scheduleTable.ajax.url(domain + 'student_schedule/schedule/' + user_id).load();

    });


    function ajaxSend(type, params, action, clickRow, url) {
        $.ajax({
            type: type,
            url: url,
            data: params,
            dataType: "json",
            success: function (response) {
                switch (action) {
                    case "ajaxSelect":
                        if (response.success) {
                            showSuccessNotification("Student schedule updated successfully!");
                            //applicantTable.row(clickRow).remove().draw();
                            scheduleTable.ajax.url(domain + 'student_schedule/schedule/' + user_id).load();
                        } else {
                            showErrorMessage("Unexpected error #1, Please try again");
                            console.log(response);
                        }
                        break;

                    case "ajaxRemove":
                        if (response.success) {
                            showSuccessNotification("Schedule removed successfully!");
                            scheduleTable.ajax.reload(null, false);
                        } else {
                            showErrorMessage("Unexpected error #2, Please try again");
                            console.log(response);
                        }
                        break;


                }
            },
            error: function (xhr, status, error) {
                console.log(xhr);
                showErrorMessage("Unexpected error");
                console.log(status, error);
            }
        });
    }

    function showErrorMessage(msg) {
        swal(msg + "!", '', "error");
    }

    function showSuccessNotification(msg) {
        showNotification('alert-success', msg, 'top', 'right', null, null, 2000);
    }

});
</script>
